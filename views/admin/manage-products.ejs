<% layout('layouts/boilerplate') %>
<h1>Manage products</h1>
<table class="table table-hover">
    <thead>
        <tr>
            <th scope="col">Category</th>
            <th scope="col">Name</th>
            <th scope="col">Price</th>
            <th scope="col">Stock</th>
            <th scope="col">Discount (%)</th>
            <th scope="col">Quick edit</th>
            <th scope="col">Save</th>
        </tr>
    </thead>
    <tbody>
        <% for (let product of products) { %>
        <form action="/manage/products?product=<%=product._id%>" method="POST">
            <tr id="<%=product._id%>" class="<%=product.stock >= 10 ? '' : 'table-danger'%>">
                <td class="text-capitalize"><%=product.category%></td>
                <td>
                    <input type="text" name="product[name]" class="form-control" value="<%=product.name%>" readonly required>
                </td>
                <td>
                    <input type="number" name="product[price]" class="form-control" value="<%=product.price%>" readonly required>
                </td>
                <td>
                    <input type="number" name="product[stock]" class="form-control" value="<%=product.stock%>" readonly required>
                </td>
                <td>
                    <input type="number" name="product[discount]" class="form-control" value="<%=product.discount%>" readonly required>
                </td>
                <td>
                    <button type="button" class="btn btn-secondary" id="edit<%=product._id%>"><i class="fas fa-edit"></i></button>
                </td>
                <td>
                    <button class="btn btn-info"><i class="fas fa-save"></i></button>
                </td>
            </tr>
        </form>
        <% } %>
    </tbody>
</table>

<script>
    const products = <%-JSON.stringify(products)%>;
    for (let product of products) {
        const id = product._id;
        const button = document.getElementById(`edit${id}`);
        const row = document.getElementById(id);
        button.addEventListener('click', function() {
            for (let i = 0; i < row.children.length; i++) {
                const child = row.children[i];
                if (child.tagName == "TD" & child.children.length > 0) {
                    child.children[0].toggleAttribute('readonly');
                }
            }
        })
    }
</script>